<!doctype html>
<html lang="zh-Hans" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.2">
<title data-react-helmet="true">CLVM Reference Manual | Chialisp</title><meta data-react-helmet="true" property="og:url" content="http://cpp6d.github.io/chialisp-web//chialisp-web/zh-Hans/docs/ref/serialization"><meta data-react-helmet="true" name="docusaurus_locale" content="zh-Hans"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="CLVM Reference Manual | Chialisp"><meta data-react-helmet="true" name="description" content="Serialization"><meta data-react-helmet="true" property="og:description" content="Serialization"><link data-react-helmet="true" rel="shortcut icon" href="/chialisp-web/zh-Hans/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="http://cpp6d.github.io/chialisp-web//chialisp-web/zh-Hans/docs/ref/serialization"><link data-react-helmet="true" rel="alternate" href="http://cpp6d.github.io/chialisp-web//chialisp-web/docs/ref/serialization" hreflang="en"><link data-react-helmet="true" rel="alternate" href="http://cpp6d.github.io/chialisp-web//chialisp-web/zh-Hans/docs/ref/serialization" hreflang="zh-Hans"><link data-react-helmet="true" rel="alternate" href="http://cpp6d.github.io/chialisp-web//chialisp-web/docs/ref/serialization" hreflang="x-default"><link rel="stylesheet" href="/chialisp-web/zh-Hans/assets/css/styles.ad8e254e.css">
<link rel="preload" href="/chialisp-web/zh-Hans/assets/js/runtime~main.a3f653e3.js" as="script">
<link rel="preload" href="/chialisp-web/zh-Hans/assets/js/main.a8cafe8e.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#main" class="skipToContent_1oUP">跳到主要内容</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/chialisp-web/zh-Hans/"><img src="/chialisp-web/zh-Hans/img/logo.svg" alt="Chialisp Logo" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/chialisp-web/zh-Hans/img/logo.svg" alt="Chialisp Logo" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"><b class="navbar__title">Chialisp</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/chialisp-web/zh-Hans/docs/">Docs</a><a href="https://chialisp.com/training" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>Training<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><a href="https://chia.net/blog" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>Blog<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><a href="https://chia.net" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>Chia.net<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><div class="navbar__item dropdown dropdown--hoverable dropdown--left"><a href="#" class="navbar__item navbar__link"><span><svg viewBox="0 0 20 20" width="20" height="20" aria-hidden="true" style="vertical-align:text-bottom;margin-right:5px"><path fill="currentColor" d="M19.753 10.909c-.624-1.707-2.366-2.726-4.661-2.726-.09 0-.176.002-.262.006l-.016-2.063 3.525-.607c.115-.019.133-.119.109-.231-.023-.111-.167-.883-.188-.976-.027-.131-.102-.127-.207-.109-.104.018-3.25.461-3.25.461l-.013-2.078c-.001-.125-.069-.158-.194-.156l-1.025.016c-.105.002-.164.049-.162.148l.033 2.307s-3.061.527-3.144.543c-.084.014-.17.053-.151.143.019.09.19 1.094.208 1.172.018.08.072.129.188.107l2.924-.504.035 2.018c-1.077.281-1.801.824-2.256 1.303-.768.807-1.207 1.887-1.207 2.963 0 1.586.971 2.529 2.328 2.695 3.162.387 5.119-3.06 5.769-4.715 1.097 1.506.256 4.354-2.094 5.98-.043.029-.098.129-.033.207l.619.756c.08.096.206.059.256.023 2.51-1.73 3.661-4.515 2.869-6.683zm-7.386 3.188c-.966-.121-.944-.914-.944-1.453 0-.773.327-1.58.876-2.156a3.21 3.21 0 011.229-.799l.082 4.277a2.773 2.773 0 01-1.243.131zm2.427-.553l.046-4.109c.084-.004.166-.01.252-.01.773 0 1.494.145 1.885.361.391.217-1.023 2.713-2.183 3.758zm-8.95-7.668a.196.196 0 00-.196-.145h-1.95a.194.194 0 00-.194.144L.008 16.916c-.017.051-.011.076.062.076h1.733c.075 0 .099-.023.114-.072l1.008-3.318h3.496l1.008 3.318c.016.049.039.072.113.072h1.734c.072 0 .078-.025.062-.076-.014-.05-3.083-9.741-3.494-11.04zm-2.618 6.318l1.447-5.25 1.447 5.25H3.226z"></path></svg><span>简体中文</span></span></a><ul class="dropdown__menu"><li><a href="/chialisp-web/docs/ref/serialization" target="_self" rel="noopener noreferrer" class="dropdown__link" style="text-transform:capitalize">English</a></li><li><a href="/chialisp-web/zh-Hans/docs/ref/serialization" target="_self" rel="noopener noreferrer" class="dropdown__link dropdown__link--active" style="text-transform:capitalize">简体中文</a></li></ul></div></div><div class="navbar__items navbar__items--right"><a href="https://github.com/Chia-Network/chialisp-web" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><div class="react-toggle displayOnlyInLargeViewport_GrZ2 react-toggle--disabled"><div class="react-toggle-track" role="button" tabindex="-1"><div class="react-toggle-track-check"><span class="toggle_71bT">🌜</span></div><div class="react-toggle-track-x"><span class="toggle_71bT">🌞</span></div><div class="react-toggle-thumb"></div></div><input type="checkbox" class="react-toggle-screenreader-only" aria-label="Switch between dark and light mode"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/chialisp-web/zh-Hans/"><img src="/chialisp-web/zh-Hans/img/logo.svg" alt="Chialisp Logo" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/chialisp-web/zh-Hans/img/logo.svg" alt="Chialisp Logo" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"><b class="navbar__title">Chialisp</b></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a aria-current="page" class="menu__link navbar__link--active" href="/chialisp-web/zh-Hans/docs/">Docs</a></li><li class="menu__list-item"><a href="https://chialisp.com/training" target="_blank" rel="noopener noreferrer" class="menu__link"><span>Training<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="menu__list-item"><a href="https://chia.net/blog" target="_blank" rel="noopener noreferrer" class="menu__link"><span>Blog<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="menu__list-item"><a href="https://chia.net" target="_blank" rel="noopener noreferrer" class="menu__link"><span>Chia.net<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="menu__list-item"><a href="https://github.com/Chia-Network/chialisp-web" target="_blank" rel="noopener noreferrer" class="menu__link"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="menu__list-item menu__list-item--collapsed"><a href="#" role="button" class="menu__link menu__link--sublist"><span><svg viewBox="0 0 20 20" width="20" height="20" aria-hidden="true" style="vertical-align:text-bottom;margin-right:5px"><path fill="currentColor" d="M19.753 10.909c-.624-1.707-2.366-2.726-4.661-2.726-.09 0-.176.002-.262.006l-.016-2.063 3.525-.607c.115-.019.133-.119.109-.231-.023-.111-.167-.883-.188-.976-.027-.131-.102-.127-.207-.109-.104.018-3.25.461-3.25.461l-.013-2.078c-.001-.125-.069-.158-.194-.156l-1.025.016c-.105.002-.164.049-.162.148l.033 2.307s-3.061.527-3.144.543c-.084.014-.17.053-.151.143.019.09.19 1.094.208 1.172.018.08.072.129.188.107l2.924-.504.035 2.018c-1.077.281-1.801.824-2.256 1.303-.768.807-1.207 1.887-1.207 2.963 0 1.586.971 2.529 2.328 2.695 3.162.387 5.119-3.06 5.769-4.715 1.097 1.506.256 4.354-2.094 5.98-.043.029-.098.129-.033.207l.619.756c.08.096.206.059.256.023 2.51-1.73 3.661-4.515 2.869-6.683zm-7.386 3.188c-.966-.121-.944-.914-.944-1.453 0-.773.327-1.58.876-2.156a3.21 3.21 0 011.229-.799l.082 4.277a2.773 2.773 0 01-1.243.131zm2.427-.553l.046-4.109c.084-.004.166-.01.252-.01.773 0 1.494.145 1.885.361.391.217-1.023 2.713-2.183 3.758zm-8.95-7.668a.196.196 0 00-.196-.145h-1.95a.194.194 0 00-.194.144L.008 16.916c-.017.051-.011.076.062.076h1.733c.075 0 .099-.023.114-.072l1.008-3.318h3.496l1.008 3.318c.016.049.039.072.113.072h1.734c.072 0 .078-.025.062-.076-.014-.05-3.083-9.741-3.494-11.04zm-2.618 6.318l1.447-5.25 1.447 5.25H3.226z"></path></svg><span>Languages</span></span></a><ul class="menu__list"><li class="menu__list-item"><a href="/chialisp-web/docs/ref/serialization" target="_self" rel="noopener noreferrer" class="menu__link" style="text-transform:capitalize">English</a></li><li class="menu__list-item"><a href="/chialisp-web/zh-Hans/docs/ref/serialization" target="_self" rel="noopener noreferrer" class="menu__link dropdown__link--active" style="text-transform:capitalize">简体中文</a></li></ul></li></ul></div></div></div></nav><div class="main-wrapper docs-wrapper doc-page"><div class="docPage_31aa"><aside class="docSidebarContainer_3Kbt"><div class="sidebar_15mo"><nav class="menu menu--responsive thin-scrollbar menu_Bmed menuWithAnnouncementBar_2WvA" aria-label="Sidebar navigation"><button aria-label="打开菜单" aria-haspopup="true" class="button button--secondary button--sm menu__button" type="button"><svg class="sidebarMenuIcon_fgN0" width="24" height="24" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><ul class="menu__list"><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Chialisp</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/chialisp-web/zh-Hans/docs/">1 - CLVM Basics</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/chialisp-web/zh-Hans/docs/coins_spends_and_wallets">2 - Coins, Spends and Wallets</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/chialisp-web/zh-Hans/docs/deeper_into_clvm">3 - Deeper into CLVM</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/chialisp-web/zh-Hans/docs/high_level_lang">4 - The High Level Language, Compiler, and Functions</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/chialisp-web/zh-Hans/docs/common_functions">5 - Common Functions in Chialisp</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/chialisp-web/zh-Hans/docs/standard_transaction">6 - The Standard Transaction</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/chialisp-web/zh-Hans/docs/coin_lifecycle">7 - Lifecycle of a Coin</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/chialisp-web/zh-Hans/docs/security">8 - Security</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/chialisp-web/zh-Hans/docs/debugging">9 - Debugging</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/chialisp-web/zh-Hans/docs/optimization">10 - Optimization</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/chialisp-web/zh-Hans/docs/glossary">The Great Chia Glossary</a></li></ul></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#!">CLVM</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/chialisp-web/zh-Hans/docs/ref/clvm">CLVM Reference</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active active" tabindex="0" href="/chialisp-web/zh-Hans/docs/ref/serialization">Serialization</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Puzzles</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/chialisp-web/zh-Hans/docs/puzzles/singletons">Singletons</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/chialisp-web/zh-Hans/docs/puzzles/pooling">Pooling</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Tutorials</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/chialisp-web/zh-Hans/docs/tutorials/why_chia_is_great">Why Chia is Great</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/chialisp-web/zh-Hans/docs/tutorials/developing_applications">An Overview of Developing Applications on Chia</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/chialisp-web/zh-Hans/docs/tutorials/tools_and_setup">Tools and Setup</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/chialisp-web/zh-Hans/docs/tutorials/programming_chialisp">Programming in Chialisp</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/chialisp-web/zh-Hans/docs/tutorials/coin_lifecycle_and_testing">Coin Lifecycle and Testing</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/chialisp-web/zh-Hans/docs/tutorials/singletons">Singletons and Ethereum-like Contracts in Chia</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/chialisp-web/zh-Hans/docs/tutorials/custom_puzzle_lock">Lock a coin with a custom puzzle</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/chialisp-web/zh-Hans/docs/tutorials/coin_spend_rpc">Spend a coin using RPC</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">FAQ</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/chialisp-web/zh-Hans/docs/faq">ChiaLisp and CLVM FAQ</a></li></ul></li></ul></nav></div></aside><main class="docMainContainer_3ufF"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_3FnS"><div class="docItemContainer_33ec"><article><div class="markdown"><header><h1 class="h1Heading_27L5">CLVM Reference Manual</h1></header><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="serialization"></a>Serialization<a class="hash-link" href="#serialization" title="标题的直接链接">#</a></h2><p>The CLVM serialization format closely follows the in-memory representation of the program tree.</p><p>This in turn, closely resembles the text format of a fully compiled CLVM program.</p><p>At the lowest level, there are only two types of Object in the CLVM.</p><ul><li>Pair (also called Cons Pair/Cons Box/Cons Cell) - A pair of two values. Usually, the first value is an atom and contains information, whereas the second value is usually either a pointer to another pair, or a <code>nil</code> atom. Lists are built from these pairs.</li><li>Atom - A value that holds data, which is represented as a byte array with the static length. Empty, zero-length atoms are used to represent <code>nil</code> value.</li></ul><p>Each CLVM Object is represented by a series of one or more bytes. Each byte belongs to the representation of exactly one CLVM Object. That is, no bits in a byte are shared by multiple CLVM objects.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="values"></a>Values<a class="hash-link" href="#values" title="标题的直接链接">#</a></h3><p>Each value in the CLVM is an untyped sequence of bytes. In the running virtual machine, values have a property length, containing the number of bytes. The same concept is preserved in the serialization format. However, values must be distinguished from cons boxes in the byte stream, so an escaping scheme is used. This escaping means that serialized values using more than 7 bits have a different representation than the in memory representation.</p><p>Nil has a single predefined value which is not shared with any user-defined value.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="encoding"></a>Encoding<a class="hash-link" href="#encoding" title="标题的直接链接">#</a></h3><p>Values which can be represented in 7 bits are encoded as a single byte with that value. Larger serialized values are represented as a sequence of bytes that encode the size, and then the value bytes.</p><p>The encoding scheme for the size prefix is as follows:</p><p>The value of the first serialized byte determines the number of size bytes (1 to 6, including the first byte). The size then determines the number of bytes denoting the value (0 to 0x400000000-1 bytes long)</p><p><strong>size</strong> is the length of the byte array containing the value, as an integer. In the table below, we use <strong>s</strong> to describe the bytes that make up the encoded size value, s[0] being the least significant byte of <strong>size</strong>. The size bytes are encoded MSB first.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#383a42;background-color:#fafafa;font-weight:bold"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">object is cons box:   0xFF</span></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">value == nil:         0x80</span></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">value &lt;= 0x7F:        value</span></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">size &lt; 0x40:          0x80 | s[0], value</span></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">size &lt; 0x2000:        0xC0 | s[1], s[0], value</span></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">size &lt; 0x100000:      0xE0 | s[2], s[1], s[0], value</span></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">size &lt; 0x8000000:     0xF0 | s[3], s[2], s[1], s[0], value</span></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">size &lt; 0x400000000:   0xF8 | s[4], s[3], s[2], s[1], s[0], value</span></span></code></pre><button type="button" aria-label="复制代码到剪贴板" class="copyButton_Ue-o clean-btn">复制</button></div></div><p>In the table below, the bits marked x contain the length of the value array, in bytes.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="encoded-size-bytes-layout"></a>Encoded Size bytes layout<a class="hash-link" href="#encoded-size-bytes-layout" title="标题的直接链接">#</a></h3><table><thead><tr><th>Size bytes</th><th>Min Value Len</th><th>Max Value Length</th><th>Byte 1</th><th>Byte 2</th><th>Byte 3</th><th>Byte 4</th><th>Byte 5</th></tr></thead><tbody><tr><td>1</td><td>0x00</td><td>0x3F</td><td>1xxxxxxx</td><td></td><td></td><td></td><td></td></tr><tr><td>2</td><td>0x40</td><td>0x1FFF</td><td>11xxxxxx</td><td>xxxxxxxx</td><td></td><td></td><td></td></tr><tr><td>3</td><td>0x2000</td><td>0xFFFFF</td><td>111xxxxx</td><td>xxxxxxxx</td><td>xxxxxxxx</td><td></td><td></td></tr><tr><td>4</td><td>0x100000</td><td>0x7FFFFFF</td><td>1111xxxx</td><td>xxxxxxxx</td><td>xxxxxxxx</td><td>xxxxxxxx</td><td></td></tr><tr><td>5</td><td>0x8000000</td><td>0x3FFFFFFFF</td><td>11111xxx</td><td>xxxxxxxx</td><td>xxxxxxxx</td><td>xxxxxxxx</td><td>xxxxxxxx</td></tr></tbody></table><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="decoding"></a>Decoding<a class="hash-link" href="#decoding" title="标题的直接链接">#</a></h3><p>The decoding scheme is as follows:</p><p>c[0] is the first byte of the serialized CLVM object.</p><p><strong>size</strong> is the number of bytes contained in the value byte array <strong>s</strong> is the byte array containing the bytes of the two&#x27;s complement integer size, the number of bytes in the value array. <strong>value</strong> is the span of bytes describing the CLVM Object itself</p><p>c[0] can contain the entire value, or it can be part of the size header. Values below 0x80 do not have size header bytes.</p><p>0x00-0x7f: A literal one byte value. c[0] contains the value. <code>size = 1; value = c[0]</code></p><p>0x80-0xbf: The value starts at the byte c[1], and size is in the lower 6 bits of c[0] <code>size = (c[0] &amp; 0x3F); value = c[1] .. c[size]</code></p><p>0xc0-0xdf: The value starts at c[2]; the lower 5 bits of c[0] are the high bits of size <code>size = (c[0] &amp; 0x1F) .. c[1]; value = c[2] .. c[size+1]</code></p><p>0xe0-0xef: The value starts at c[3]; the lower 4 bits of c[0] are the high bits of size <code>size = (c[0] &amp; 0x0F) .. c[2]; value = c[3] .. c[size+2]</code></p><p>0xf0-0xf7: The value starts at c[4]; the lower 3 bits of c[0] are the high bits of size <code>size = (c[0] &amp; 0x07) .. c[3]; value = c[4] .. c[size+3]</code></p><p>0xf7-0xfb: The value starts at c[5]; the lower 2 bits of c[0] are the high bits of size <code>size = (c[0] &amp; 0x03) .. c[4]; value = c[5] .. c[size+4]</code></p><p>Atoms of size 0x400000000 or greater are disallowed in the serialization format.</p><p>As an example:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#383a42;background-color:#fafafa;font-weight:bold"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">c = [ 0x84 0x33 0x22 0x11 0x00 ]</span></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">c[0] = 0x84</span></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">size = (0x84 &amp; 0x3F) = 4</span></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">value = [ 33 22 11 00 ]</span></span></code></pre><button type="button" aria-label="复制代码到剪贴板" class="copyButton_Ue-o clean-btn">复制</button></div></div><p>In the above example, the length of the value is <strong>4</strong>, and we only needed the bottom 3 bits of the c[0] byte to encode the length, so the size is completely described by the first serialized byte. The total length of the encoded atom is 5 bytes.</p><p>Note that for values greater than 0x7F, the bytes of the serialized value representing the length are disjoint with the actual value bytes.</p><p>Let us consider some special cases.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#383a42;background-color:#fafafa;font-weight:bold"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">value(0x80) = 81 80</span></span></code></pre><button type="button" aria-label="复制代码到剪贴板" class="copyButton_Ue-o clean-btn">复制</button></div></div><p>c[0] is <code>0x81</code>.Since c[0] is between <code>0x7F</code> and <code>0xC0</code>, we know that there is only one size byte, c[0], and the value is contained in the following bytes, starting at c[1]. The total size of the value array is <code>size</code> = <code>c[0] &amp; 0x3F</code> = <code>0x1</code>. So, the full value is contained in the single following byte.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#383a42;background-color:#fafafa;font-weight:bold"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">value(0x81) = 81 81</span></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">value(0x82) = 81 82</span></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">value(0xFF) = 81 ff</span></span></code></pre><button type="button" aria-label="复制代码到剪贴板" class="copyButton_Ue-o clean-btn">复制</button></div></div><p>Note that the special byte 0xFF is allowed within the bytes representing a value. 0xFF denotes a cons box when it is the first byte of a decoded CLVM object, but it may also occur within the serialized bytes of a value.</p><p>A 2 byte value</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#383a42;background-color:#fafafa;font-weight:bold"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">value(0x01FF) = 82 01 ff</span></span></code></pre><button type="button" aria-label="复制代码到剪贴板" class="copyButton_Ue-o clean-btn">复制</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="lists"></a>Lists<a class="hash-link" href="#lists" title="标题的直接链接">#</a></h3><p>Lists are the primary high-level data structure in most LISP implementations. Traditionally, a LISP builds lists from cons boxes, a two-celled data structure that can be thought of as a struct with two fields, left and right, each of which contains either a value, or a (pointer to) another cons cell.</p><p>Because the cons cell is the low level data structure that lists are built from, LISP lists are only lists by way of the fact that lists can be implemented from trees. A lisp list built from cons cells in a binary tree.</p><p>Serialized cons cells are represented by the byte 0xFF, followed by the objects in its cells, left then right. Values are represented by a variable length byte-aligned encoding scheme, described above. Nil is chosen to be the zero-length object, which is represented by the byte 0x80.</p><p>Because lists are represented as a sequence of cons boxes, the byte 0xff occurs frequently in the serialization format.</p><p>After the FF introducer byte, the next two values describe what is in the left and right cons boxes, respectively.</p><p>The first examples use single byte values for clarity.</p><p>The list (1 2 3) will be encoded as:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#383a42;background-color:#fafafa;font-weight:bold"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">ff 01 ff 02 ff 03 80</span></span></code></pre><button type="button" aria-label="复制代码到剪贴板" class="copyButton_Ue-o clean-btn">复制</button></div></div><p>This can be read as:</p><p><code>(a cons box containing 01</code> and <code>a cons box (containing 02</code> and <code>a cons box (containing 03 and nil)))</code></p><p>Alternatively, it could be viewed as a binary tree that looks like this:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#383a42;background-color:#fafafa;font-weight:bold"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">      [ ]</span></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">     /   \</span></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">    1    [ ]</span></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">         / \</span></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">        2  [ ]</span></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">           / \</span></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">          3  nil</span></span></code></pre><button type="button" aria-label="复制代码到剪贴板" class="copyButton_Ue-o clean-btn">复制</button></div></div><p>Or, as a chain of memory cells that look like this:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#383a42;background-color:#fafafa;font-weight:bold"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">(a)[ 1, -&gt;b ]   (b)[ 2, -&gt;c ]   (c)[ 3, nil ]</span></span></code></pre><button type="button" aria-label="复制代码到剪贴板" class="copyButton_Ue-o clean-btn">复制</button></div></div><p>Where</p><ul><li>(a) means &quot;The contents of the memory cells at position a and a+1 (cons box a)&quot;</li><li>-&gt;b means &quot;a pointer to cons box (b)&quot;</li><li><code>(a)</code>, <code>(b)</code>, <code>(c)</code> are arbitrary labels for the cons cells, and do not exist in the CLVM</li></ul><p>Because the above list contains only one level of nesting, a single <code>0x80</code> byte is sufficient to terminate the list. Note the two <code>0x80</code> bytes in the example below.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#383a42;background-color:#fafafa;font-weight:bold"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">opc &#x27;(1 (2 3))&#x27;</span></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">ff 01 ff ff 02 ff 03 80 80</span></span></code></pre><button type="button" aria-label="复制代码到剪贴板" class="copyButton_Ue-o clean-btn">复制</button></div></div><p>There can be many cons cells in a CLVM program, so 0xFF will be common in the serialized program. There will be one serialized nil (0x80) per properly terminated list. Nil may also occur at other places in the program. There are usually more cons boxes than lists, so 0xFF occurs more frequently than 0x80.</p></div><footer class="row docusaurus-mt-lg"><div class="col"><a href="https://github.com/Chia-Network/chialisp-web/edit/main/docs/ref/serialization.md" target="_blank" rel="noreferrer noopener"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_2_ui" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>编辑此页</a></div><div class="col lastUpdated_3DPF"></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="文档分页导航"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/chialisp-web/zh-Hans/docs/ref/clvm"><div class="pagination-nav__sublabel">上一页</div><div class="pagination-nav__label">« CLVM Reference</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/chialisp-web/zh-Hans/docs/puzzles/singletons"><div class="pagination-nav__sublabel">下一页</div><div class="pagination-nav__label">Singletons »</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_35-E thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#serialization" class="table-of-contents__link">Serialization</a><ul><li><a href="#values" class="table-of-contents__link">Values</a></li><li><a href="#encoding" class="table-of-contents__link">Encoding</a></li><li><a href="#encoded-size-bytes-layout" class="table-of-contents__link">Encoded Size bytes layout</a></li><li><a href="#decoding" class="table-of-contents__link">Decoding</a></li><li><a href="#lists" class="table-of-contents__link">Lists</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/chialisp-web/zh-Hans/docs/">CLVM Basics</a></li><li class="footer__item"><a class="footer__link-item" href="/chialisp-web/zh-Hans/docs/coins_spends_and_wallets/">Coins, Spends and Wallets</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items"><li class="footer__item"><a href="https://keybase.io/team/chia_network.public" target="_blank" rel="noopener noreferrer" class="footer__link-item">Keybase</a></li><li class="footer__item"><a href="https://twitter.com/chia_project" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter</a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items"><li class="footer__item"><a href="https://www.chia.net/blog/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Blog</a></li><li class="footer__item"><a href="https://github.com/Chia-Network/clvm" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub</a></li></ul></div></div><div class="footer__bottom text--center"><div class="margin-bottom--sm"><a class="footerLogoLink_MyFc" href="/chialisp-web/zh-Hans/"><img src="/chialisp-web/zh-Hans/img/full_logo_white.svg" alt="Chialisp full logo" class="themedImage_1VuW themedImage--light_3UqQ footer__logo"><img src="/chialisp-web/zh-Hans/img/full_logo_white.svg" alt="Chialisp full logo" class="themedImage_1VuW themedImage--dark_hz6m footer__logo"></a></div><div class="footer__copyright">Copyright © 2021 Chia Network Inc. Built with Docusaurus.</div></div></div></footer></div>
<script src="/chialisp-web/zh-Hans/assets/js/runtime~main.a3f653e3.js"></script>
<script src="/chialisp-web/zh-Hans/assets/js/main.a8cafe8e.js"></script>
</body>
</html>